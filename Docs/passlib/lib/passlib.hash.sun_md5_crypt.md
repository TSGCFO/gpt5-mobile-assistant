<!-- Source: https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sun_md5_crypt.html -->

### Navigation

- [index](https://passlib.readthedocs.io/en/stable/genindex.html "General Index")
- [modules](https://passlib.readthedocs.io/en/stable/py-modindex.html "Python Module Index")
- [toc](https://passlib.readthedocs.io/en/stable/contents.html "Table Of Contents")
- [next](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.des_crypt.html "passlib.hash.des_crypt - DES Crypt")
- [previous](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sha1_crypt.html "passlib.hash.sha1_crypt - SHA-1 Crypt")
- [Passlib 1.7 Documentation](https://passlib.readthedocs.io/en/stable/index.html) »
- [API Reference](https://passlib.readthedocs.io/en/stable/lib/index.html) »
- [`passlib.hash` \- Password Hashing Schemes](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.html) »

# [`passlib.hash.sun_md5_crypt`](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sun_md5_crypt.html\#passlib.hash.sun_md5_crypt "passlib.hash.sun_md5_crypt") \- Sun MD5 Crypt [¶](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sun_md5_crypt.html\#passlib-hash-sun-md5-crypt-sun-md5-crypt "Permalink to this headline")

This algorithm was developed by Alec Muffett [\[1\]](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sun_md5_crypt.html#mct) for Solaris, as a replacement for the aging [`des_crypt`](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.des_crypt.html#passlib.hash.des_crypt "passlib.hash.des_crypt").
It was introduced in Solaris 9u2. While based on the MD5 message digest, it has very little at all
in common with the [`md5_crypt`](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.md5_crypt.html#passlib.hash.md5_crypt "passlib.hash.md5_crypt") algorithm. It supports
32 bit variable rounds and an 8 character salt.

See also

[password hash usage](https://passlib.readthedocs.io/en/stable/narr/hash-tutorial.html#password-hash-examples) –
for examples of how to use this class via the common hash interface.

Note

The original Solaris implementation has some hash encoding quirks
which may not be properly accounted for in Passlib.
Until more user feedback and sample hashes have been gathered,
_caveat emptor_.

## Interface [¶](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sun_md5_crypt.html\#interface "Permalink to this headline")

_class_ `passlib.hash.` `sun_md5_crypt` [¶](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sun_md5_crypt.html#passlib.hash.sun_md5_crypt "Permalink to this definition")

This class implements the Sun-MD5-Crypt password hash, and follows the [PasswordHash API](https://passlib.readthedocs.io/en/stable/lib/passlib.ifc.html#password-hash-api).

It supports a variable-length salt, and a variable number of rounds.

The [`using()`](https://passlib.readthedocs.io/en/stable/lib/passlib.ifc.html#passlib.ifc.PasswordHash.using "passlib.ifc.PasswordHash.using") method accepts the following optional keywords:

| Parameters: | - **salt** ( [_str_](https://docs.python.org/3/library/stdtypes.html#str "(in Python v3.9)")) – Optional salt string.<br>  If not specified, a salt will be autogenerated (this is recommended).<br>  If specified, it must be drawn from the regexp range `[./0-9A-Za-z]`.<br>- **salt\_size** ( [_int_](https://docs.python.org/3/library/functions.html#int "(in Python v3.9)")) – If no salt is specified, this parameter can be used to specify<br>  the size (in characters) of the autogenerated salt.<br>  It currently defaults to 8.<br>- **rounds** ( [_int_](https://docs.python.org/3/library/functions.html#int "(in Python v3.9)")) – Optional number of rounds to use.<br>  Defaults to 34000, must be between 0 and 4294963199, inclusive.<br>- **bare\_salt** ( [_bool_](https://docs.python.org/3/library/functions.html#bool "(in Python v3.9)")) – Optional flag used to enable an alternate salt digest behavior<br>  used by some hash strings in this scheme.<br>  This flag can be ignored by most users.<br>  Defaults to `False`.<br>  (see [Bare Salt Issue](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sun_md5_crypt.html#smc-bare-salt) for details).<br>- **relaxed** ( [_bool_](https://docs.python.org/3/library/functions.html#bool "(in Python v3.9)")) – <br>  By default, providing an invalid value for one of the other<br>  keywords will result in a [`ValueError`](https://docs.python.org/3/library/exceptions.html#ValueError "(in Python v3.9)"). If `relaxed=True`,<br>  and the error can be corrected, a [`PasslibHashWarning`](https://passlib.readthedocs.io/en/stable/lib/passlib.exc.html#passlib.exc.PasslibHashWarning "passlib.exc.PasslibHashWarning")<br>  will be issued instead. Correctable errors include `rounds`<br>  that are too small or too large, and `salt` strings that are too long.<br>  <br>  <br>  <br>  New in version 1.6. |

## Format [¶](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sun_md5_crypt.html\#format "Permalink to this headline")

An example hash (of `passwd`) is `$md5,rounds=5000$GUBv0xjJ$$mSwgIswdjlTY0YxV7HBVm0`.
A sun-md5-crypt hash string has the format `$md5,rounds=rounds$salt$$checksum`, where:

- `$md5,` is the prefix used to identify the hash.
- `rounds` is the decimal number of rounds to use (5000 in the example).
- `salt` is 0-8 salt characters drawn from `[./0-9A-Za-z]` ( `GUBv0xjJ` in the example).
- `checksum` is 22 characters drawn from the same set,
encoding a 128-bit checksum ( `mSwgIswdjlTY0YxV7HBVm0` in the example).

An alternate format, `$md5$salt$$checksum` is used when the rounds value is 0.

There also exists some hashes which have only a single `$` between the
salt and the checksum; these have a slightly different checksum calculation
(see [Bare Salt Issue](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sun_md5_crypt.html#smc-bare-salt) for details).

Note

Solaris seems to deviate from the [Modular Crypt Format](https://passlib.readthedocs.io/en/stable/modular_crypt_format.html#modular-crypt-format) in that
it considers `,` to indicate the end of the identifier
in addition to `$`.

## Algorithm [¶](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sun_md5_crypt.html\#algorithm "Permalink to this headline")

The algorithm used is based around the MD5 message digest and the “Muffett Coin Toss” algorithm.

1. Given a password, the number of rounds, and a salt string.

2. an initial MD5 digest is created from the concatenation of the password,
and the configuration string (using the format `$md5,rounds=rounds$salt$`,
or `$md5$salt$` if rounds is 0).

(See [Bare Salt Issue](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sun_md5_crypt.html#smc-bare-salt) for details about an issue affecting this step)

3. for rounds+4096 iterations, a new digest is created:

1. a buffer is initialized, containing the previous round’s MD5 digest (for the first round,
the digest from step 2 is used).
2. `MuffetCoinToss(rounds, previous digest)` is called, resulting in a 0 or 1.
3. If step 3.ii results in a 1, a constant data string is added to the buffer;
if the result is a 0, the string is not added for this round.
The constant data string is a 1517 byte excerpt from Hamlet [\[2\]](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sun_md5_crypt.html#f2)
( `To be, or not to be...all my sins remember'd.\n`),
including an appended null character.
4. the current iteration as a zero-indexed integer is converted to a string (not zero-padded) and added to the buffer.
5. the output for this iteration is the MD5 digest of the buffer’s contents.

4. The final digest is then encoded into `hash64` format using the same
transposed byte order that [`md5_crypt`](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.md5_crypt.html#passlib.hash.md5_crypt "passlib.hash.md5_crypt") uses, and returned.


### Muffet Coin Toss [¶](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sun_md5_crypt.html\#muffet-coin-toss "Permalink to this headline")

The Muffet Coin Toss algorithm is as follows:
Given the current round number, and a 16 byte MD5 digest, it returns a 0 or 1,
using the following formula:

Note

All references below to a specific bit of the digest should be interpreted mod 128.
All references below to a specific byte of the digest should be interpreted mod 16.

1. A 8-bit integer `X` is generated from the following formula:
for each `i` in 0..7 inclusive:


> - let `A` be the `i`’th byte of the digest, as an 8-bit int.
> - let `B` be the `i+3`’rd byte of the digest, as an 8-bit int.
> - let `R` be `A` shifted right by `B % 5` bits.
> - let `V` be the `R`’th byte of the digest.
> - if the `A % 8`’th bit of `B` is 1, divide `V` by 2.
> - use the `V`’th bit of the digest as the `i`’th bit of `X`.

2. Another 8-bit integer, `Y`, is generated exactly the same manner as `X`, except that:


> - `A` is the `i+8`’th byte of the digest,
> - `B` is the `i+11`’th byte of the digest.

3. if bit `round` of the digest is 1, `X` is divided by 2.

4. if bit `round+64` of the digest is 1, `Y` is divided by 2.

5. the final result is `X`’th bit of the digest XORed against `Y`’th bit of the digest.


### Bare Salt Issue [¶](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sun_md5_crypt.html\#bare-salt-issue "Permalink to this headline")

According to the only existing documentation of this algorithm [\[1\]](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sun_md5_crypt.html#mct),
its hashes were supposed to have the format `$md5$salt$checksum`,
and include only the bare string `$md5$salt` in the salt digest step
(see [step 2](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sun_md5_crypt.html#smc-digest-step), above).

However, almost all hashes encountered in production environments
have the format `$md5$salt$$checksum` (note the double `$$`).
Unfortunately, it is not merely a cosmetic difference: hashes of this format
incorporate the first `$` after the salt within the
salt digest step, so the resulting checksum is different.

The documentation hints that this stems from a bug within the production
implementation’s parser. This bug causes the implementation to return
`$$`-format hashes when passed a configuration string that ends with `$`.
It returns the intended original format & checksum
only if there is at least one letter after the `$`, e.g. `$md5$salt$x`.

Passlib attempts to accommodate both formats using the special `bare_salt`
keyword. It is set to `True` to indicate a configuration or hash string which
contains only a single `$`, and does not incorporate it into the hash calculation.
The `$$` hash is encountered more often in production since it seems
the Solaris salt generator always appends a `$`; because of this `bare_salt=False`
was chosen as the default, so that hashes will be generated which by default
conform to what users are used to.

## Deviations [¶](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sun_md5_crypt.html\#deviations "Permalink to this headline")

Passlib’s implementation of Sun-MD5-Crypt deliberately
deviates from the official implementation in the following ways:

- Unicode Policy:

The underlying algorithm takes in a password specified
as a series of non-null bytes, and does not specify what encoding
should be used; though a `us-ascii` compatible encoding
is implied by all known reference hashes.

In order to provide support for unicode strings,
Passlib will encode unicode passwords using `utf-8`
before running them through sun-md5-crypt. If a different
encoding is desired by an application, the password should be encoded
before handing it to Passlib.

- Rounds encoding

The underlying scheme implicitly allows rounds to have zero padding (e.g. `$md5,rounds=001$abc$`),
and also allows 0 rounds to be specified two ways ( `$md5$abc$` and `$md5,rounds=0$abc$`).
Allowing either of these would result in multiple possible checksums
for the same password & salt. To prevent ambiguity,
Passlib will throw a [`ValueError`](https://docs.python.org/3/library/exceptions.html#ValueError "(in Python v3.9)") if the rounds value is zero-padded,
or specified explicitly as 0 (e.g. `$md5,rounds=0$abc$`).


Given the lack of documentation, lack of test vectors, and known bugs
which accompany the original Solaris implementation, Passlib may not
accurately be able to generate and verify all hashes encountered in a
Solaris environment. Issues of concern include:

- Some hashes found on the web use a `$` in place of the `,`.
It is unclear whether this is an accepted alternate format or just a typo,
nor whether this is supposed to affect the checksum in the resulting hash string.
- The current implementation needs addition test vectors;
especially ones which contain an explicitly specific number of rounds.
- More information is needed about the parsing / formatting issue described
in the [Bare Salt Issue](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sun_md5_crypt.html#smc-bare-salt) section.

Footnotes

|     |     |
| --- | --- |
| \[1\] | _( [1](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sun_md5_crypt.html#id1), [2](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sun_md5_crypt.html#id3))_ Overview of & motivations for the algorithm - [http://dropsafe.crypticide.com/article/1389](http://dropsafe.crypticide.com/article/1389) |

|     |     |
| --- | --- |
| [\[2\]](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sun_md5_crypt.html#id2) | The source of Hamlet’s speech, used byte-for-byte as the constant data - [http://www.ibiblio.org/pub/docs/books/gutenberg/etext98/2ws2610.txt](http://www.ibiblio.org/pub/docs/books/gutenberg/etext98/2ws2610.txt) |

[![Logo](https://passlib.readthedocs.io/en/stable/_static/masthead.png)](https://passlib.readthedocs.io/en/stable/index.html "index")

### Quick search

### [Table of Contents](https://passlib.readthedocs.io/en/stable/contents.html)

- [Introduction](https://passlib.readthedocs.io/en/stable/index.html)
- [Walkthrough & Tutorials](https://passlib.readthedocs.io/en/stable/narr/index.html)
- [API Reference](https://passlib.readthedocs.io/en/stable/lib/index.html)
  - [`passlib.apache` \- Apache Password Files](https://passlib.readthedocs.io/en/stable/lib/passlib.apache.html)
  - [`passlib.apps` \- Helpers for various applications](https://passlib.readthedocs.io/en/stable/lib/passlib.apps.html)
  - [`passlib.context` \- CryptContext Hash Manager](https://passlib.readthedocs.io/en/stable/lib/passlib.context.html)
  - [`passlib.crypto` \- Cryptographic Helper Functions](https://passlib.readthedocs.io/en/stable/lib/passlib.crypto.html)
  - [`passlib.exc` \- Exceptions and warnings](https://passlib.readthedocs.io/en/stable/lib/passlib.exc.html)
  - [`passlib.ext.django` \- Django Password Hashing Plugin](https://passlib.readthedocs.io/en/stable/lib/passlib.ext.django.html)
  - [`passlib.hash` \- Password Hashing Schemes](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.html)
    - [Overview](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.html#overview)
    - [Unix Hashes](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.html#unix-hashes)
      - [Active Unix Hashes](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.html#active-unix-hashes)
      - [Deprecated Unix Hashes](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.html#deprecated-unix-hashes)
        - [`passlib.hash.md5_crypt` \- MD5 Crypt](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.md5_crypt.html)
        - [`passlib.hash.sha1_crypt` \- SHA-1 Crypt](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sha1_crypt.html)
        - [`passlib.hash.sun_md5_crypt` \- Sun MD5 Crypt](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sun_md5_crypt.html#)
          - [Interface](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sun_md5_crypt.html#interface)
          - [Format](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sun_md5_crypt.html#format)
          - [Algorithm](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sun_md5_crypt.html#algorithm)
            - [Muffet Coin Toss](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sun_md5_crypt.html#muffet-coin-toss)
            - [Bare Salt Issue](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sun_md5_crypt.html#bare-salt-issue)
          - [Deviations](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sun_md5_crypt.html#deviations)
      - [Archaic Unix Hashes](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.html#archaic-unix-hashes)
    - [Other “Modular Crypt” Hashes](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.html#other-modular-crypt-hashes)
    - [LDAP / RFC2307 Hashes](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.html#ldap-rfc2307-hashes)
    - [SQL Database Hashes](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.html#sql-database-hashes)
    - [MS Windows Hashes](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.html#ms-windows-hashes)
    - [Cisco Hashes](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.html#cisco-hashes)
    - [Other Hashes](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.html#other-hashes)
  - [`passlib.hosts` \- OS Password Handling](https://passlib.readthedocs.io/en/stable/lib/passlib.hosts.html)
  - [`passlib.ifc` – Password Hash Interface](https://passlib.readthedocs.io/en/stable/lib/passlib.ifc.html)
  - [`passlib.pwd` – Password generation helpers](https://passlib.readthedocs.io/en/stable/lib/passlib.pwd.html)
  - [`passlib.registry` \- Password Handler Registry](https://passlib.readthedocs.io/en/stable/lib/passlib.registry.html)
  - [`passlib.totp` – TOTP / Two Factor Authentication](https://passlib.readthedocs.io/en/stable/lib/passlib.totp.html)
  - [`passlib.utils` \- Helper Functions](https://passlib.readthedocs.io/en/stable/lib/passlib.utils.html)
- [Other Documentation](https://passlib.readthedocs.io/en/stable/other.html)

«
hide menumenusidebar
»


### Navigation

- [index](https://passlib.readthedocs.io/en/stable/genindex.html "General Index")
- [modules](https://passlib.readthedocs.io/en/stable/py-modindex.html "Python Module Index")
- [toc](https://passlib.readthedocs.io/en/stable/contents.html "Table Of Contents")
- [next](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.des_crypt.html "passlib.hash.des_crypt - DES Crypt")
- [previous](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sha1_crypt.html "passlib.hash.sha1_crypt - SHA-1 Crypt")
- [Passlib 1.7 Documentation](https://passlib.readthedocs.io/en/stable/index.html) »
- [API Reference](https://passlib.readthedocs.io/en/stable/lib/index.html) »
- [`passlib.hash` \- Password Hashing Schemes](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.html) »

Versions[latest](https://passlib.readthedocs.io/en/latest/lib/passlib.hash.sun_md5_crypt.html)**[stable](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sun_md5_crypt.html)**[1.7.3](https://passlib.readthedocs.io/en/1.7.3/lib/passlib.hash.sun_md5_crypt.html)Downloads[PDF](https://passlib.readthedocs.io/_/downloads/en/stable/pdf/)[HTML](https://passlib.readthedocs.io/_/downloads/en/stable/htmlzip/)On Read the Docs[Project Home](https://app.readthedocs.org/projects/passlib/?utm_source=passlib&utm_content=flyout)[Builds](https://app.readthedocs.org/projects/passlib/builds/?utm_source=passlib&utm_content=flyout)Search

* * *

[Addons documentation](https://docs.readthedocs.io/page/addons.html?utm_source=passlib&utm_content=flyout) ― Hosted by
[Read the Docs](https://about.readthedocs.com/?utm_source=passlib&utm_content=flyout)