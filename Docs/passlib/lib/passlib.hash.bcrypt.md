<!-- Source: https://passlib.readthedocs.io/en/stable/lib/passlib.hash.bcrypt.html -->

### Navigation

- [index](https://passlib.readthedocs.io/en/stable/genindex.html "General Index")
- [modules](https://passlib.readthedocs.io/en/stable/py-modindex.html "Python Module Index")
- [toc](https://passlib.readthedocs.io/en/stable/contents.html "Table Of Contents")
- [next](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sha256_crypt.html "passlib.hash.sha256_crypt - SHA-256 Crypt")
- [previous](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.html "passlib.hash - Password Hashing Schemes")
- [Passlib 1.7 Documentation](https://passlib.readthedocs.io/en/stable/index.html) »
- [API Reference](https://passlib.readthedocs.io/en/stable/lib/index.html) »
- [`passlib.hash` \- Password Hashing Schemes](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.html) »

# [`passlib.hash.bcrypt`](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.bcrypt.html\#passlib.hash.bcrypt "passlib.hash.bcrypt") \- BCrypt [¶](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.bcrypt.html\#passlib-hash-bcrypt-bcrypt "Permalink to this headline")

BCrypt was developed to replace [`md5_crypt`](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.md5_crypt.html#passlib.hash.md5_crypt "passlib.hash.md5_crypt") for BSD systems.
It uses a modified version of the Blowfish stream cipher. Featuring
a large salt and variable number of rounds, it’s currently the default
password hash for many systems (notably BSD), and has no known weaknesses.
It is one of the four hashes Passlib [recommends](https://passlib.readthedocs.io/en/stable/narr/quickstart.html#recommended-hashes)
for new applications. This class can be used directly as follows:

```
>>> from passlib.hash import bcrypt

>>> # generate new salt, hash password
>>> h = bcrypt.hash("password")
>>> h
'$2a$12$NT0I31Sa7ihGEWpka9ASYrEFkhuTNeBQ2xfZskIiiJeyFXhRgS.Sy'

>>> # the same, but with an explicit number of rounds
>>> bcrypt.using(rounds=13).hash("password")
'$2b$13$HMQTprwhaUwmir.g.ZYoXuRJhtsbra4uj.qJPHrKsX5nGlhpts0jm'

>>> # verify password
>>> bcrypt.verify("password", h)
True
>>> bcrypt.verify("wrong", h)
False

```

Note

It is strongly recommended that you install
[bcrypt](https://pypi.python.org/pypi/bcrypt)
when using this hash.

See also

the generic [PasswordHash usage examples](https://passlib.readthedocs.io/en/stable/narr/hash-tutorial.html#password-hash-examples)

## Interface [¶](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.bcrypt.html\#interface "Permalink to this headline")

_class_ `passlib.hash.` `bcrypt` [¶](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.bcrypt.html#passlib.hash.bcrypt "Permalink to this definition")

This class implements the BCrypt password hash, and follows the [PasswordHash API](https://passlib.readthedocs.io/en/stable/lib/passlib.ifc.html#password-hash-api).

It supports a fixed-length salt, and a variable number of rounds.

The [`using()`](https://passlib.readthedocs.io/en/stable/lib/passlib.ifc.html#passlib.ifc.PasswordHash.using "passlib.ifc.PasswordHash.using") method accepts the following optional keywords:

| Parameters: | - **salt** ( [_str_](https://docs.python.org/3/library/stdtypes.html#str "(in Python v3.9)")) – Optional salt string.<br>  If not specified, one will be autogenerated (this is recommended).<br>  If specified, it must be 22 characters, drawn from the regexp range `[./0-9A-Za-z]`.<br>- **rounds** ( [_int_](https://docs.python.org/3/library/functions.html#int "(in Python v3.9)")) – Optional number of rounds to use.<br>  Defaults to 12, must be between 4 and 31, inclusive.<br>  This value is logarithmic, the actual number of iterations used will be `2**rounds`<br>  – increasing the rounds by +1 will double the amount of time taken.<br>- **ident** ( [_str_](https://docs.python.org/3/library/stdtypes.html#str "(in Python v3.9)")) – <br>  Specifies which version of the BCrypt algorithm will be used when creating a new hash.<br>  Typically this option is not needed, as the default ( `"2b"`) is usually the correct choice.<br>  If specified, it must be one of the following:<br>  <br>  - `"2"` \- the first revision of BCrypt, which suffers from a minor security flaw and is generally not used anymore.<br>  - `"2a"` \- some implementations suffered from rare security flaws, replaced by 2b.<br>  - `"2y"` \- format specific to the _crypt\_blowfish_ BCrypt implementation,<br>    identical to `"2b"` in all but name.<br>  - `"2b"` \- latest revision of the official BCrypt algorithm, current default.<br>- **truncate\_error** ( [_bool_](https://docs.python.org/3/library/functions.html#bool "(in Python v3.9)")) – <br>  By default, BCrypt will silently truncate passwords larger than 72 bytes.<br>  Setting `truncate_error=True` will cause [`hash()`](https://passlib.readthedocs.io/en/stable/lib/passlib.ifc.html#passlib.ifc.PasswordHash.hash "passlib.ifc.PasswordHash.hash")<br>  to raise a [`PasswordTruncateError`](https://passlib.readthedocs.io/en/stable/lib/passlib.exc.html#passlib.exc.PasswordTruncateError "passlib.exc.PasswordTruncateError") instead.<br>  <br>  <br>  <br>  New in version 1.7.<br>  <br>- **relaxed** ( [_bool_](https://docs.python.org/3/library/functions.html#bool "(in Python v3.9)")) – <br>  By default, providing an invalid value for one of the other<br>  keywords will result in a [`ValueError`](https://docs.python.org/3/library/exceptions.html#ValueError "(in Python v3.9)"). If `relaxed=True`,<br>  and the error can be corrected, a [`PasslibHashWarning`](https://passlib.readthedocs.io/en/stable/lib/passlib.exc.html#passlib.exc.PasslibHashWarning "passlib.exc.PasslibHashWarning")<br>  will be issued instead. Correctable errors include `rounds`<br>  that are too small or too large, and `salt` strings that are too long.<br>  <br>  <br>  <br>  New in version 1.6. |

Changed in version 1.6: This class now supports `"2y"` hashes, and recognizes
(but does not support) the broken `"2x"` hashes.
(see the [crypt\_blowfish bug](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.bcrypt.html#crypt-blowfish-bug)
for details).

Changed in version 1.6: Added a pure-python backend.

Changed in version 1.6.3: Added support for `"2b"` variant.

Changed in version 1.7: Now defaults to `"2b"` variant.

### Bcrypt Backends [¶](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.bcrypt.html\#index-0 "Permalink to this headline")

Warning

Support for `py-bcrypt` and `bcryptor` will be dropped in Passlib 1.8,
as these libraries are unmaintained.

This class will use the first available of five possible backends:

1. [bcrypt](https://pypi.python.org/pypi/bcrypt), if installed.
2. [py-bcrypt](https://pypi.python.org/pypi/py-bcrypt), if installed (DEPRECATED)
3. [bcryptor](https://bitbucket.org/ares/bcryptor/overview), if installed (DEPRECATED).
4. stdlib’s [`crypt.crypt()`](https://docs.python.org/3/library/crypt.html#crypt.crypt "(in Python v3.9)"), if the host OS supports BCrypt
(primarily BSD-derived systems).
5. A pure-python implementation of BCrypt, built into Passlib.

If no backends are available, `hash()` and `verify()`
will throw [`MissingBackendError`](https://passlib.readthedocs.io/en/stable/lib/passlib.exc.html#passlib.exc.MissingBackendError "passlib.exc.MissingBackendError") when they are invoked.
You can check which backend is in use by calling `bcrypt.get_backend()`.

As of Passlib 1.6.3, a one-time check is peformed when the backend is first loaded,
to detect the backend’s capabilities & bugs. If this check detects a fatal bug,
a [`PasslibSecurityError`](https://passlib.readthedocs.io/en/stable/lib/passlib.exc.html#passlib.exc.PasslibSecurityError "passlib.exc.PasslibSecurityError") will be raised. This generally means
you need to upgrade the external package being used as the backend
(this will be detailed in the error message).

Warning

_The pure-python backend (#5) is disabled by default!_

That backend is currently too slow to be usable given the number of rounds required
for security. That said, if you have no other alternative and need to use it,
set the environmental variable `PASSLIB_BUILTIN_BCRYPT="enabled"`
before importing Passlib.

What’s “too slow”? Passlib’s [rounds selection guidelines](https://passlib.readthedocs.io/en/stable/narr/hash-tutorial.html#rounds-selection-guidelines)
currently require BCrypt be able to do at least 12 cost in under 300ms. By this standard
the pure-python backend is 128x too slow under CPython 2.7, and 16x too slow under PyPy 1.8.
(speedups are welcome!)

## Format & Algorithm [¶](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.bcrypt.html\#format-algorithm "Permalink to this headline")

Bcrypt is compatible with the [Modular Crypt Format](https://passlib.readthedocs.io/en/stable/modular_crypt_format.html#modular-crypt-format), and uses a number of identifying
prefixes: `$2$`, `$2a$`, `$2x$`, `$2y$`, and `$2b$`. Each prefix indicates
a different revision of the BCrypt algorithm; and all but the `$2b$` identifier are
considered deprecated.

An example hash (of `password`) is:

> `$2b$12$GhvMmNVjRW29ulnudl.LbuAnUtN/LRfe1JsBm1Xu6LE3059z5Tr8m`

Bcrypt hashes have the format `$2a$rounds$saltchecksum`, where:

- `rounds` is a cost parameter, encoded as 2 zero-padded decimal digits,
which determines the number of iterations used via `iterations=2**rounds` (rounds is 12 in the example).
- `salt` is a 22 character salt string, using the characters in the regexp range `[./A-Za-z0-9]` ( `GhvMmNVjRW29ulnudl.Lbu` in the example).
Note that due to padding bits within the encoding, the last character should always be one of `[.Oeu]`:
under some bcrypt implementations, other final characters may result in false negatives when verifying.
- `checksum` is a 31 character checksum, using the same characters as the salt ( `AnUtN/LRfe1JsBm1Xu6LE3059z5Tr8m` in the example).

While BCrypt’s basic algorithm is described in its design document [\[1\]](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.bcrypt.html#f1),
the OpenBSD implementation [\[2\]](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.bcrypt.html#f2) is considered the canonical reference, even
though it differs from the design document in a few small ways.

## Security Issues [¶](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.bcrypt.html\#security-issues "Permalink to this headline")

- Password Truncation.

While not a security issue per-se, bcrypt does have one major limitation:
password are truncated on the first NULL byte (if any),
and only the first 72 bytes of a password are hashed… all the rest are ignored.
Furthermore, bytes 55-72 are not fully mixed into the resulting hash (citation needed!).
To work around both these issues, many applications first run the password through a message
digest such as (HMAC-) SHA2-256. Passlib offers the premade [passlib.hash.bcrypt\_sha256 - BCrypt+SHA256](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.bcrypt_sha256.html)
to take care of this issue.


## Deviations [¶](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.bcrypt.html\#deviations "Permalink to this headline")

This implementation of bcrypt differs from others in a few ways:

- Restricted salt string character set:

BCrypt does not specify what the behavior should be when
passed a salt string outside of the regexp range `[./A-Za-z0-9]`.
In order to avoid this situation, Passlib strictly limits salts to the
allowed character set, and will throw a [`ValueError`](https://docs.python.org/3/library/exceptions.html#ValueError "(in Python v3.9)") if an invalid
salt character is encountered.

- Unicode Policy:

The underlying algorithm takes in a password specified
as a series of non-null bytes, and does not specify what encoding
should be used; though a `us-ascii` compatible encoding
is implied by nearly all implementations of bcrypt
as well as all known reference hashes.

In order to provide support for unicode strings,
Passlib will encode unicode passwords using `utf-8`
before running them through bcrypt. If a different
encoding is desired by an application, the password should be encoded
before handing it to Passlib.

- Padding Bits

BCrypt’s base64 encoding results in the last character of the salt
encoding only 2 bits of data, the remaining 4 are “padding” bits.
Similarly, the last character of the digest contains 4 bits of data,
and 2 padding bits. Because of the way they are coded, many BCrypt implementations
will reject _all_ passwords if these padding bits are not set to 0.
Due to a legacy [issue](https://passlib.readthedocs.io/en/stable/history/1.5.html#bcrypt-padding-issue) with Passlib <= 1.5.2,
Passlib will print a warning if it encounters hashes with any padding bits set,
and then validate the hash as if the padding bits were cleared.
(This behavior will eventually be deprecated and such hashes
will throw a [`ValueError`](https://docs.python.org/3/library/exceptions.html#ValueError "(in Python v3.9)") instead).

- The _crypt\_blowfish_ 8-bit bug

Pre-1.1 versions of the [crypt\_blowfish](http://www.openwall.com/crypt/)
bcrypt implementation suffered from a serious flaw [\[3\]](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.bcrypt.html#eight)
in how they handled 8-bit passwords. The manner in which the flaw was fixed resulted
in _crypt\_blowfish_ adding support for two new BCrypt hash identifiers:

`$2x$`, allowing sysadmins to mark any `$2a$` hashes which were potentially
generated with the buggy algorithm. Passlib 1.6 recognizes (but does not
currently support generating or verifying) these hashes.

`$2y$`, the default for crypt\_blowfish 1.1-1.2, indicates
the hash was generated with the canonical OpenBSD-compatible algorithm,
and should match _correctly_ generated `$2a$` hashes.
Passlib 1.6 can generate and verify these hashes.

As well, crypt\_blowfish 1.2 modified the way it generates `$2a$` hashes,
so that passwords containing the byte value 0xFF are hashed in a manner
incompatible with either the buggy or canonical algorithms. Passlib
does not support this algorithmic variant either, though it should
be _very_ rarely encountered in practice.

(crypt\_blowfish 1.3 switched to the `$2b$` standard as the default)



Changed in version 1.6.3: Passlib will now throw a [`PasslibSecurityError`](https://passlib.readthedocs.io/en/stable/lib/passlib.exc.html#passlib.exc.PasslibSecurityError "passlib.exc.PasslibSecurityError") if an attempt is
made to use any backend which is vulnerable to this bug.

- The ‘BSD wraparound’ bug

OpenBSD <= 5.4, and most bcrypt libraries derived from it’s source,
are vulnerable to a ‘wraparound’ bug [\[4\]](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.bcrypt.html#wraparound), where passwords larger
than 254 characters will be incorrectly hashed using only the first few
characters of the string, resulting in a severely weakened hash.

OpenBSD 5.5 [fixed](http://undeadly.org/cgi?action=article&sid=20140224132743) this flaw,
and introduced the `$2b$` hash identifier to indicate the hash was generated with the correct
algorithm.

py-bcrypt <= 0.4 is known to be vulnerable to this, as well as the os\_crypt
backend (if running on a vulnerable operating system).

Passlib 1.6.3 adds the following:

  - Support for the `$2b$` hash format (though for backward compat it has not been made
    the default yet).
  - Detects if the active backend is vulnerable to the bug, issues a warning,
    and enables a workaround so that vulnerable passwords will still be hashed correctly.
    (This does mean that existing hashes suffering this vulnerability will no longer verify
    using their correct password).

Footnotes

|     |     |
| --- | --- |
| [\[1\]](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.bcrypt.html#id3) | the bcrypt format specification -<br>[http://www.usenix.org/event/usenix99/provos/provos\_html/](http://www.usenix.org/event/usenix99/provos/provos_html/) |

|     |     |
| --- | --- |
| [\[2\]](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.bcrypt.html#id4) | the OpenBSD BCrypt source -<br>[http://www.openbsd.org/cgi-bin/cvsweb/src/lib/libc/crypt/bcrypt.c](http://www.openbsd.org/cgi-bin/cvsweb/src/lib/libc/crypt/bcrypt.c) |

|     |     |
| --- | --- |
| [\[3\]](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.bcrypt.html#id5) | The flaw in pre-1.1 crypt\_blowfish is described here -<br>[CVE-2011-2483](http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2011-2483) |

|     |     |
| --- | --- |
| [\[4\]](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.bcrypt.html#id6) | The wraparound flaw is described here -<br>[http://www.openwall.com/lists/oss-security/2012/01/02/4](http://www.openwall.com/lists/oss-security/2012/01/02/4) |

[![Logo](https://passlib.readthedocs.io/en/stable/_static/masthead.png)](https://passlib.readthedocs.io/en/stable/index.html "index")

### Quick search

### [Table of Contents](https://passlib.readthedocs.io/en/stable/contents.html)

- [Introduction](https://passlib.readthedocs.io/en/stable/index.html)
- [Walkthrough & Tutorials](https://passlib.readthedocs.io/en/stable/narr/index.html)
- [API Reference](https://passlib.readthedocs.io/en/stable/lib/index.html)
  - [`passlib.apache` \- Apache Password Files](https://passlib.readthedocs.io/en/stable/lib/passlib.apache.html)
  - [`passlib.apps` \- Helpers for various applications](https://passlib.readthedocs.io/en/stable/lib/passlib.apps.html)
  - [`passlib.context` \- CryptContext Hash Manager](https://passlib.readthedocs.io/en/stable/lib/passlib.context.html)
  - [`passlib.crypto` \- Cryptographic Helper Functions](https://passlib.readthedocs.io/en/stable/lib/passlib.crypto.html)
  - [`passlib.exc` \- Exceptions and warnings](https://passlib.readthedocs.io/en/stable/lib/passlib.exc.html)
  - [`passlib.ext.django` \- Django Password Hashing Plugin](https://passlib.readthedocs.io/en/stable/lib/passlib.ext.django.html)
  - [`passlib.hash` \- Password Hashing Schemes](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.html)
    - [Overview](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.html#overview)
    - [Unix Hashes](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.html#unix-hashes)
      - [Active Unix Hashes](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.html#active-unix-hashes)
        - [`passlib.hash.bcrypt` \- BCrypt](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.bcrypt.html#)
          - [Interface](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.bcrypt.html#interface)
            - [Bcrypt Backends](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.bcrypt.html#index-0)
          - [Format & Algorithm](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.bcrypt.html#format-algorithm)
          - [Security Issues](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.bcrypt.html#security-issues)
          - [Deviations](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.bcrypt.html#deviations)
        - [`passlib.hash.sha256_crypt` \- SHA-256 Crypt](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sha256_crypt.html)
        - [`passlib.hash.sha512_crypt` \- SHA-512 Crypt](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sha512_crypt.html)
        - [`passlib.hash.unix_disabled` \- Unix Disabled Account Helper](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.unix_disabled.html)
      - [Deprecated Unix Hashes](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.html#deprecated-unix-hashes)
      - [Archaic Unix Hashes](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.html#archaic-unix-hashes)
    - [Other “Modular Crypt” Hashes](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.html#other-modular-crypt-hashes)
    - [LDAP / RFC2307 Hashes](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.html#ldap-rfc2307-hashes)
    - [SQL Database Hashes](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.html#sql-database-hashes)
    - [MS Windows Hashes](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.html#ms-windows-hashes)
    - [Cisco Hashes](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.html#cisco-hashes)
    - [Other Hashes](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.html#other-hashes)
  - [`passlib.hosts` \- OS Password Handling](https://passlib.readthedocs.io/en/stable/lib/passlib.hosts.html)
  - [`passlib.ifc` – Password Hash Interface](https://passlib.readthedocs.io/en/stable/lib/passlib.ifc.html)
  - [`passlib.pwd` – Password generation helpers](https://passlib.readthedocs.io/en/stable/lib/passlib.pwd.html)
  - [`passlib.registry` \- Password Handler Registry](https://passlib.readthedocs.io/en/stable/lib/passlib.registry.html)
  - [`passlib.totp` – TOTP / Two Factor Authentication](https://passlib.readthedocs.io/en/stable/lib/passlib.totp.html)
  - [`passlib.utils` \- Helper Functions](https://passlib.readthedocs.io/en/stable/lib/passlib.utils.html)
- [Other Documentation](https://passlib.readthedocs.io/en/stable/other.html)

«
hide menumenusidebar
»


### Navigation

- [index](https://passlib.readthedocs.io/en/stable/genindex.html "General Index")
- [modules](https://passlib.readthedocs.io/en/stable/py-modindex.html "Python Module Index")
- [toc](https://passlib.readthedocs.io/en/stable/contents.html "Table Of Contents")
- [next](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.sha256_crypt.html "passlib.hash.sha256_crypt - SHA-256 Crypt")
- [previous](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.html "passlib.hash - Password Hashing Schemes")
- [Passlib 1.7 Documentation](https://passlib.readthedocs.io/en/stable/index.html) »
- [API Reference](https://passlib.readthedocs.io/en/stable/lib/index.html) »
- [`passlib.hash` \- Password Hashing Schemes](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.html) »

Versions[latest](https://passlib.readthedocs.io/en/latest/lib/passlib.hash.bcrypt.html)**[stable](https://passlib.readthedocs.io/en/stable/lib/passlib.hash.bcrypt.html)**[1.7.3](https://passlib.readthedocs.io/en/1.7.3/lib/passlib.hash.bcrypt.html)Downloads[PDF](https://passlib.readthedocs.io/_/downloads/en/stable/pdf/)[HTML](https://passlib.readthedocs.io/_/downloads/en/stable/htmlzip/)On Read the Docs[Project Home](https://app.readthedocs.org/projects/passlib/?utm_source=passlib&utm_content=flyout)[Builds](https://app.readthedocs.org/projects/passlib/builds/?utm_source=passlib&utm_content=flyout)Search

* * *

[Addons documentation](https://docs.readthedocs.io/page/addons.html?utm_source=passlib&utm_content=flyout) ― Hosted by
[Read the Docs](https://about.readthedocs.com/?utm_source=passlib&utm_content=flyout)